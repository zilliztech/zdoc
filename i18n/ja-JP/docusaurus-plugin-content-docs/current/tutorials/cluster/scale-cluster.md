---
title: "クラスターをスケーリル | Cloud"
slug: /scale-cluster
sidebar_label: "クラスターをスケーリル"
beta: FALSE
added_since: FALSE
last_modified: FALSE
deprecate_since: FALSE
notebook: FALSE
description: "ワークロードが増加し、より多くのデータが書き込まれることでクラスターは容量制限に達する可能性があります。このような場合、読み取り操作は機能し続けますが、新しい書き込み操作は失敗する可能性があります。 | Cloud"
type: origin
token: ExUFwDY1siCa2Bkp4incCvxFnlh
sidebar_position: 4
keywords:
  - zilliz
  - vector database
  - cloud
  - cluster
  - manage
  - What are vector embeddings
  - vector database tutorial
  - how do vector databases work
  - vector db comparison

---

import Admonition from '@theme/Admonition';


import Supademo from '@site/src/components/Supademo';

# クラスターをスケーリル

ワークロードが増加し、より多くのデータが書き込まれることでクラスターは容量制限に達する可能性があります。このような場合、読み取り操作は機能し続けますが、新しい書き込み操作は失敗する可能性があります。

これを積極的に管理するには、[メトリクス](./metrics-alerts-reference)ページで**CU容量**を監視して、スケーリルが必要な時期を判断できます。ビジネスニーズとパターンに基づいて、クエリCU数を増やしてクラスター容量を拡張したり、需要が減少したときに削減してコストを節約したりできます。

1〜8CUのクラスターではクエリCUを直接スケーリルできます。8CUを超えるクラスターでは、[レプリカ](./manage-replica)を増やすことをご確認ください。

このガイドでは、ワークロードの変化に合わせてクラスターのサイズを変更する方法を説明します。

<Admonition type="info" icon="📘" title="注意">

<p>この機能は<strong>専用</strong>クラスターでのみ利用可能です。</p>

</Admonition>

## Zilliz Cloudのスケーリル方法\{#scaling-methods-in-zilliz-cloud}

Zilliz Cloudは、クラスターをスケーリルするためのいくつかの方法を提供します：

- [手動スケーリル](./scale-cluster#manual-scaling): クエリCU数を即座に調整します。ワークロードパターンを明確に理解している場合に最適です。

    - 手動スケーパルを選択した場合、**スケジュールスケーリル**をさらに有効にして、事前定義された時間スケジュールに基づいてクエリCUリソースを調整できます。スケジュールスケーパルは、平日のピークや週末の需要低下など、繰り返しのワークロードパターンや、将来のワークロードが安定して予測可能なシナリオに最適です。

- [動的スケーパル](./scale-cluster#dynamic-scaling): リアタイムメトリクスに基づいて、ユーザー定義の最小-最大範囲内でクラスターコエリCUリソースを自動的に調整します。1日の間に急激に変動する可能性のある予測不可能なワークロードに最適です。

## 注意事項\{#considerations}

- **リソース制限**:

    - **スケーパルアップ**

        - 専用（スタンダード）クラスター: 最大32CU

            専用（エンタープライズ）クラスター: 最大256CU

        - **クエリCU数** × **レプリカ数**の積は256を超えてはいけません

        より大きなクエリCUについては、[営業担当にご連絡ください](http://zilliz.com/contact-sales)。

    - **スケーパルダウン**

        - レプリカ付きクラスターは8CU未満にスケーパルダウンできません

        - スケーパルダウン要求は以下の条件が満たされた場合にのみ成功します：

            - 現在のデータ量 < 新しいCUサイズのCU容量の80%

            - 現在のコレクション数とパーティション数 < 新しいCUサイズで許可される[最大コレクション数とパーティション数](./limits#collections)

- **スケーパル中**: クラスターのステータスは「変更中」に変わり、その間は操作を実行できません。複数のスケーパルタスクがトリガーされた場合、それらはトリガータイムスタンプに基づいて順次処理されます。完了時間はデータ量に依存します。

- **パフォーマンスへの影響**: スケーパルはわずかなサービスジャンクを引き起こす可能性があります。

- **バックアップ制限**: 動的およびスケジュールスケーパル設定は[バックアップ](./create-snapshot)に含まれません。クラスターをリストアした後は、これらの設定を手動で再構成してください。

## 手動スケーパル\{#manual-scaling}

Zilliz CloudコンソールまたはRESTful API経由でクラスターを手動でスケーパルアップまたはダウンできます。スケジュールスケーパルはウェブコンソールでのみ利用可能であることにご注意ください。

### ウェブコンソール経由\{#via-web-console}

以下のデモでは、Zilliz Cloudウェブコンソールでクラスターを手動でスケーパルアップおよびダウンする方法を示します。

<Supademo id="cmd2r0jc634jlc4kju69onxyh?utm_source=link" title=""  />

### RESTful API経由\{#via-restful-api}

以下の例では、既存のクラスターを2CUにスケーパルします。詳細については、[クラスターを変更](/reference/restful/modify-cluster-v2)を参照してください。

```bash
curl --request POST \
--url "${BASE_URL}/v2/clusters/${CLUSTER_ID}/modify" \
--header "Authorization: Bearer ${TOKEN}" \
--header "Accept: application/json" \
--header "Content-Type: application/json" \
-d '{
    "cuSize": 2
}'
```

以下は出力例です。

```bash
{
    "code": 0,
    "data": {
        "clusterId": "inxx-xxxxxxxxxxxxxxx",
        "prompt": "正常に送信されました。クラスターはアップグレード中であり、これには数分かかる予定です。DescribeCluster APIを使用して、クラスター作成の進行状況とステータスに関するデータにアクセスできます。クラスターのステータスがRUNNINGになると、SDKを使用してベクターデータベースにアクセスできます。"
    }
}
```

## 動的スケーパル\{#dynamic-scaling}

Zilliz Cloudは、手動操作を排除しながらパフォーマンスを維持するための動的スケーパルをサポートしています。有効にすると、システムはリアルタイムの**CU容量**メトリクスに基づいて**クエリCU**リソースを自動的に調整し、サービスの中断なくワークロードが効率的に処理されるようにします。

動的スケーパルを設定する際、以下の境界を構成できます：

- **最小クエリCU**: デフォルトは現在のサイズです。

- **最大クエリCU**: デフォルトは現在のCUサイズの4倍です。

<Admonition type="info" icon="📘" title="注意">

<ul>
<li><p>現在の値より低い最大クエリCUを選択すると、即座にスケーパルダウンがトリガーされます。</p></li>
<li><p>現在の値より高い最小クエリCUを選択すると、即座にスケーパルアップがトリガーされます。</p></li>
</ul>

</Admonition>

### トリガー条件\{#trigger-conditions}

- スケーパルアップ: CU容量が10分間80%を超えるとトリガーされます。または、CU容量が100%に達すると即座にスケーパルアップがトリガーされます。

- スケーパルダウン: CU容量が30分間60%を下回り続けるとトリガーされます。

- スケーパルアップイベント間には10分のクールダウン期間が適用され、スケーパルダウンイベント間には30分のクールダウン期間が適用されます。スケーパルダウンは、ターゲットメトリクス値が達成されるまでサイズごとに実行されます。

### スケーパルサイズ計算\{#scaling-size-calculation}

以下の式は、Zilliz Cloudが動的スケーパルイベントのターゲットクエリCU数を計算する方法を説明します。動的スケーパル式は、CU容量を70%のターゲット値で維持することを目的としています。

```plaintext
ターゲットクエリCU数 = 現在のクエリCU数 × (現在のメトリクス値 / ターゲットメトリクス値)
```

<table>
   <tr>
     <th><p>変数名</p></th>
     <th><p>説明</p></th>
   </tr>
   <tr>
     <td><p>ターゲットクエリCU数</p></td>
     <td><p>システムがクラスターをスケーパルする対象となる新サイズ。</p></td>
   </tr>
   <tr>
     <td><p>現在のクエリCU数</p></td>
     <td><p>クラスターの現在のクエリCU数。</p></td>
   </tr>
   <tr>
     <td><p>現在のメトリクス値</p></td>
     <td><p>CU容量メトリクスの現在の測定値。</p></td>
   </tr>
   <tr>
     <td><p>ターゲットメトリクス値</p></td>
     <td><p>スケーパル後の予想CU容量値で、70です。</p></td>
   </tr>
</table>

たとえば、動的スケーパルが有効で、以下の条件が満たされている場合：

- **現在のクエリCU数:** 60CU

- **クラスターCU容量:** 10分間80%を超える

動的スケーパルイベントがトリガーされます。ターゲットクエリCU数は以下のように計算されます：

```plaintext
60 × (80 / 70) ≈ 68.57CU
```

この値は次の利用可能なCU数に切り上げられ、新しいサイズは**72CU**になります。

### 手順\{#procedures}

以下のデモでは、Zilliz Cloudウェブコンソールで動的自動スケーパルを構成する方法を示します。

<Supademo id="cmd2r7eqb34nbc4kj3wly357s?utm_source=link" title=""  />

## スケーパル進行状況を表示\{#view-scaling-progress}

手動スケーパルリクエストが送信されたまたは動的スケーパルイベントがトリガーされると、ジョブレコードが生成されます。[ジョブ](./job-center)ページで進行状況を確認できます。

スケーパルジョブが進行中になると、クラスターのステータスは「変更中」に変わります。スケーパルジョブが成功すると、クラスターのステータスは「実行中」に変わります。

## よくある質問\{#faq}

1. **どのスケーパルオプションを選択すべきですか？**

    以下は、ニーズに合った適切なスケーパル方法を選ぶための簡単なヒントです：

![YfDow6t7Bh9HONbg60RcQryvnfe](/img/YfDow6t7Bh9HONbg60RcQryvnfe.png)

    - 毎日のピークや計画的なバッチインポートジョブなど、ワークロードパターンを非常に明確に理解している場合は、**手動**スケーパルと**スケジュール**スケーパルが適切なオプションです。クエリCUを即座に調整する必要がある場合は、手動スケーパルを選択してください。特定の将来の時間に繰り返し調整が発生する場合は、スケジュールスケーパルを選択してください。

    - ワークロードが予測不可能で、1日または1週間の間に変化する場合は、**動的スケーパル**が推奨されます。定義した範囲内でクラスターサイズを自動的に調整し、パフォーマンスを維持しながらコストを最適化するのに役立ちます。

1. **レプリカをスケーパルするタイミングとクエリCUをスケーパルするタイミングは？**

    以下を推奨します：

    - **レプリカ**数を増やすのは：

        - 高QPS（1秒あたりのクエリ数）と高可用性を処理する必要がある場合。

        - 多数の同時検索またはクエリ要求を処理するワークロードです。スループットを増やす必要があります。

        *ヒント: 各つのレプリカはクエリCUリソースの独立したコピーであり、クエリのサブセットを処理します。*

    - **クエリCU**を増やすのは：

        - 大規模なデータセットを扱っている場合や、より多くのコレクションが必要な場合。

        - 高CPUまたはメモリ使用率が見られる場合。

        *ヒント: CUサイズを増やすと、各クエリノードにより多くのコンピューティングリソースと容量が与えられます。*

    - **提案**: 1〜8CUのクラスターではクエリCUを直接スケーパルできます。8CUを超えるクラスターでは、レプリカを増やすことをご確認ください。

1. **クラスターをスケーパルダウンする際の制限は何ですか？**

    レプリカ付きクラスターは8CU未満にスケーパルダウンできません。

    スケーパルダウン要求は、以下の両方の条件が満たされた場合にのみ成功します：

    - 現在のデータ量は新しいCUサイズの容量の80%未満です。

    - コレクション数とパーティション数は新しいCUサイズで許可される制限内です。
